@model OnlineLibrary.Infrastructure.Domain.Entities.Book

@{

    var selectedCategoryIds =
        ViewBag.SelectedCategoryIds as List<Guid> ?? new List<Guid>();

    ViewData["Title"] = "Add Book";
    Layout = "_Layout";
}

<div class="container mt-4">
    <h2>Add New Book</h2>

    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger">
            @ViewBag.Error
        </div>
    }

    <form asp-action="Create"
          method="post"
          enctype="multipart/form-data"
          class="card p-4 shadow-sm">

        <!-- TITLE -->
        <div class="mb-3">
            <label class="form-label">Title</label>
            <input asp-for="Title" class="form-control" required />
        </div>

        <!-- AUTHOR -->
        <div class="mb-3">
            <label class="form-label">Author</label>
            <input asp-for="Author" class="form-control" />
        </div>

        <!-- PUBLISHER -->
        <div class="mb-3">
            <label class="form-label">Publisher</label>
            <input asp-for="Publisher" class="form-control" />
        </div>

        <!-- CATEGORY -->
        <div class="mb-3">
            <label class="form-label">Categories</label>

            <select name="CategoryIds"
                    class="form-select category-select"
                    multiple
                    style="width:100%">
                @foreach (var c in ViewBag.Categories)
                {
                    if (selectedCategoryIds.Contains(c.CategoryId))
                    {
                        <option value="@c.CategoryId" selected>
                            @c.CategoryName
                        </option>
                    }
                    else
                    {
                        <option value="@c.CategoryId">
                            @c.CategoryName
                        </option>
                    }
                }

            </select>
        </div>

        <!-- ISBN -->
        <div class="mb-3">
            <label class="form-label">ISBN</label>
            <input asp-for="ISBN"
                   class="form-control"
                   placeholder="Leave empty to auto-generate" />
        </div>

        <!-- DESCRIPTION -->
        <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea asp-for="Description"
                      class="form-control"
                      rows="3"></textarea>
        </div>

        <!-- PUBLISH DATE -->
        <div class="mb-3">
            <label class="form-label">Publish Date</label>
            <input asp-for="PublishDate"
                   type="date"
                   class="form-control" />
        </div>

        <!-- PURCHASE DATE (SYSTEM) -->
        <div class="mb-3">
            <label class="form-label">Purchase Date</label>
            <input type="date"
                   class="form-control"
                   value="@DateTime.Today.ToString("yyyy-MM-dd")"
                   readonly />
            <small class="text-muted">Set automatically by system</small>
        </div>

        <!-- PRICE (TK) -->
        <div class="mb-3">
            <label class="form-label">Price (TK)</label>
            <input asp-for="Price"
                   type="number"
                   step="0.01"
                   min="0"
                   class="form-control" />
        </div>

        <!-- TOTAL COPIES -->
        <div class="mb-3">
            <label class="form-label">Total Copies</label>
            <input asp-for="TotalCopies"
                   type="number"
                   min="0"
                   class="form-control" />
        </div>

        <!-- IMAGE -->
        <div class="mb-3">
            <label class="form-label">Book Image</label>
            <input type="file"
                   name="imageFile"
                   class="form-control"
                   accept="image/*" />
        </div>

        <button type="submit" class="btn btn-success">
            Save Book
        </button>

        <a asp-action="Index" class="btn btn-secondary ms-2">
            Cancel
        </a>
    </form>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('.category-select').select2({
                placeholder: "Select categories",
                allowClear: true,
                closeOnSelect: false,
                width: '100%'
            });
        });
    </script>
}
